# Kafka

### 简介

Apache Kafka是一个开源消息系统，由Scala写成。是由Apache软件基金会开发的一个开源的分布式消息队列。

### 工作原理

消息中间件适用于需要可靠的数据传送的分布式环境。不同的应用程序直接并不直接关联，而是通过消息中间件提供的应用程序接口协同工作。

<img src="images/work.jpg">

1、应用程序A完成任务后发送消息给消息中间件

2、在合适的时候，消息中间件将应用程序A发送过来的消息传递给应用程序B

3、应用程序B接收到消息中间件发来的应用程序A的消息，开始下一步操作，并把结果发送给消息中间件

### 中间件作用

#### 解耦：

在项目启动之初来预测将来会碰到什么需求是极其困难的。消息中间件在处理过程中间插入了一个隐含的、基于数据的接口层，两边的处理过程都要实现这一接口，这允许你独立地扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束即可。

#### 冗余（存储）：

有些情况下，处理数据的过程会失败。消息中间件可以把数据进行持久化直到它们已经被完全处理，通过这一方式规避了数据丢失风险。在把一个消息从消息中间件中删除之前，需要你的处理系统明确地指出该消息已经被处理完成，从而确保你的数据被安全地保存直到你使用完毕。

### Kafka相关术语

-   broker：消息代理，在 Kafka 架构中，每台 Kafka 服务器都是一个broker

-   Producer：消息生产者，就是向kafka broker发消息的客户端

-   Consumer：消息消费者，向kafka broker取消息的客户端

-   Topic：消息主题，Kafka将消息以主题的方式存储在磁盘上

-   partition：分区，Kafka 通过增加每条消息的分区来提高负载能力

-   offset：偏移量，在消费者读取消息的时候，通过索引提供的偏移量来提高消息的读取效率

-   LEO：日志文件最后偏移，Kafka 在

-   HW：此项限制了消费者能够读取的最大数据的偏移量

-   rebalance：再平衡，

-   segment：日志分段，Kafka 的日志文件是分段存储的，分段规则可以是时间也可以是文件大小

-   leader：生产者发送的每条消息都会有一个消息 leader，只有它负责与消费者交互

-   follower：

-   Replication：副本，消息备份
